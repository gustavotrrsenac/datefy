<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Perfil - DateFY</title>

  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/fonts.css') }}">

  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>

<body>

<!-- SIDEBAR -->
<aside class="sidebar">
  <h2 class="logo">Date<span>FY</span></h2>
  <ul>
    <li><a href="{{ url_for('dashboard') }}"> Vis√£o Geral</a></li>
    <li><a href="{{ url_for('vida_pessoal') }}"> Vida Pessoal</a></li>
    <li><a href="{{ url_for('financas') }}"> Finan√ßas</a></li>
    <li><a href="{{ url_for('perfil') }}" class="active"> Perfil</a></li>
    <li><a href="{{ url_for('logout') }}"> Sair</a></li>
  </ul>
</aside>


<!-- CONTE√öDO PRINCIPAL -->
<main class="perfil-container" x-data="{aba: 'pessoais'}">

  <h1 class="titulo-perfil">Perfil</h1>

  <!-- BLOCO FOTO + NOME -->
  <div class="perfil-box">

    <div class="perfil-usuario">
      <img src="{{ url_for('static', filename='img/avatar.png') }}">
      </div>


      <div class="perfil-topo">
        <h2>{{ usuario.nome }}</h2>
        <p>Gerencie suas informa√ß√µes e configura√ß√µes</p>
      </div>
    </div> 

    <div style="display:flex; gap:20px; margin-top:20px;">

      <!-- ABAS -->
      <div class="perfil-tabs">
        <button :class="{ 'active': aba === 'pessoais' }" @click="aba = 'pessoais'">üë§ Dados Pessoais</button>
        <button :class="{ 'active': aba === 'seguranca' }" @click="aba = 'seguranca'">üîí Seguran√ßa</button>
        <button :class="{ 'active': aba === 'contas' }" @click="aba = 'contas'">üè¶ Contas Banc√°rias</button>
        <button :class="{ 'active': aba === 'notificacoes' }" @click="aba = 'notificacoes'">üîî Notifica√ß√µes</button>
      </div>

      <!-- CONTE√öDO DAS ABAS -->
      <div class="perfil-content">

        <!-- DADOS PESSOAIS -->
        <form method="POST" action="{{ url_for('salvar_preferencias') }}">

        <div x-show="aba === 'pessoais'">
          <h3 style="margin-bottom:18px;">Dados Pessoais</h3>

          <div class="form-group">
            <label>Nome completo</label>
            <input class="form-input" name="nome" value="{{ usuario.nome }}">
          </div>

          <div class="form-group">
            <label>E-mail</label>
            <input class="form-input" name="email" value="{{ usuario.email }}">
          </div>
        </div>

        <!-- SEGURAN√áA -->
        <div x-show="aba === 'seguranca'">
          <h3 style="margin-bottom:18px;">Seguran√ßa</h3>

          <div class="form-group">
            <label>Senha Atual</label>
            <input type="password" class="form-input" name="senha_atual">
          </div>

          <div class="form-group">
            <label>Nova Senha</label>
            <input type="password" class="form-input" name="nova_senha">
          </div>

          <div class="form-group">
            <label>Confirmar Nova Senha</label>
            <input type="password" class="form-input" name="confirmar_senha">
          </div>

        </div>

        <!-- CONTAS BANC√ÅRIAS -->
        <div x-show="aba === 'contas'">
          <h3>Minhas Contas Banc√°rias</h3>

          {% if usuario.contas %}
            {% for conta in usuario.contas %}
              <div class="conta-card">
                <strong>{{ conta.banco }}</strong><br>
                Ag√™ncia: {{ conta.agencia }} - Conta: {{ conta.numero }}
                <input type="hidden" name="conta_id_{{ loop.index }}" value="{{ conta.id }}">
                <input class="form-input" name="conta_banco_{{ loop.index }}" value="{{ conta.banco }}">
                <input class="form-input" name="conta_agencia_{{ loop.index }}" value="{{ conta.agencia }}">
                <input class="form-input" name="conta_numero_{{ loop.index }}" value="{{ conta.numero }}">
              </div>
            {% endfor %}
          {% else %}
              <p>Nenhuma conta cadastrada.</p>
          {% endif %}

          <a href="{{ url_for('criar_conta') }}" class="btn-nova-conta">
            ‚ûï Vincular Nova Conta
          </a>
        </div>
        
        <!-- NOTIFICA√á√ïES -->
        <div x-show="aba === 'notificacoes'">
          <h3 style="margin-bottom:18px;">Notifica√ß√µes</h3>

          <form action="/salvar_notificacoes" method="POST">

            <div class="switch-group">
              <label class="switch">
                  <input type="checkbox" name="email_alertas"
                        {% if usuario.notif_email %}checked{% endif %}>
                  <span class="slider round"></span>
              </label>
              <span class="switch-text">  Email sobre alertas financeiros</span>
            </div>

            <div class="switch-group">
              <label class="switch">
                  <input type="checkbox" name="push_alertas"
                        {% if usuario.notif_push %}checked{% endif %}>
                  <span class="slider round"></span>
              </label>
              <span class="switch-text">  Notifica√ß√µes Push de tarefas
              </span>
            </div>

            <div class="switch-group">
              <label class="switch">
                  <input type="checkbox" name="mensal_relatorio"
                        {% if usuario.notif_relatorio %}checked{% endif %}>
                  <span class="slider round"></span>
              </label>
              <span class="switch-text">  Relat√≥rio mensal autom√°tico</span>
            </div>

            </div>
              <button type="submit" class="btn-principal" style="margin-top: 20px;">
                Salvar Prefer√™ncias
              </button>
          </form>
        </div>
      </div>  

    </div>

  </div>
</main>
